# inotify的机制

对文件是否被修改进行判断，需要用到inotify的IN_MODIFY文件系统事件。
然而用gedit/vim对该文件进行修改，都无法得到IN_MODIFY事件，而会得到IN_IGNORED事件（10进制值是 0x8000）。之后，inotify就不再通知任何文件事件了！可是如果用别的方法编辑文件，比如用输出重定向>>，文件的修改事件是可以正确得到的！

要搞明白这个奇怪的现象，需要知道vim,gedit类的文本编辑程序的工作原理。这些编辑器在编辑文件时，实际上是在该文件的一个副本中进行编辑的。当用户保存文件时，编辑器先对原文件进行了删除操作，随后将副本重命名为原文件。

由于编辑器先删除了原文件，inotify发现了文件被删除了，马上就会把针对该文件的watch删掉，所以inotify通知了IN_IGNORED事件后就不再通知任何事件了！

不过还好有IN_IGNORED事件，还是可以做一些补救！
就是在收到 IN_IGNORED  事件后，重新添加监视器：
```
wd = inotify_add_watch(fd, path, IN_MODIFY);  
```
这样后面就可以继续监视了。
